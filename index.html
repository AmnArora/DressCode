<html>
  <head>
    <meta charset="utf-8">
    <title>DressCode</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" media="screen" title="no title">
    <link rel="stylesheet" href="assets/css/style.css" media="screen" title="no title">
    <script src="assets/libs/angular.min.js"></script>
    <script src="assets/libs/jquery.min.js"></script>
    <script src="assets/libs/bootstrap.min.js"></script>
    <script src="app/login/loginController.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-route.js"></script>
  </head>
  <body ng-app='dresscode'>
    <div class="container">
      <div ng-view></div>
    </div>
  </body>
  <script type="text/javascript">
  var app = angular.module('dresscode',["ngRoute"]);
  app.config(['$routeProvider', function($routeProvider) {
     $routeProvider
     .when('/', {
        templateUrl: 'app/dresscode/dresscode.html',
        controller: 'loginController'
     })
     .when('/home', {
        templateUrl: 'app/dashboard/dashboard.html',
        controller:'cartController'
     })
     .when('/cart', {
        templateUrl: 'app/cart/cart.html',
        controller:'cart'
     })
     .when('/logout', { redirectTo: '/' })
     .otherwise({ redirectTo: '/' });
  }]);
  app.controller('loginController',['$scope','$location','$http','$rootScope',function($scope,$location,$http,$rootScope){
    $scope.loginCheck = function(){
      var email = $scope.email;
      var password = $scope.password ;
      $http.get('app/login/users.json')
      .then(function(response,users){
        users = response.data;
        angular.forEach(users,function(user,key){
            if(user.email == email && user.password==password){
              $rootScope.id = user.id;
              $location.path("/home");
            }
        });
      });
      //$location.path("/home");
    };
  }]);
  app.controller('cartController',function($scope,$http,$rootScope){
    $rootScope.cart = [];
    $scope.cart = $rootScope.cart;
    $http.get('app/products/products.json').success(function (response) {
      $scope.products = response;
    });
    $scope.addToCart = function (product) {
      var found = false;
      $rootScope.cart.forEach(function (item) {
        if (item.id === product.id) {
          item.quantity++;
          found = true;
        }
      });
      if (!found) {
        $rootScope.cart.push(angular.extend({quantity: 1}, product));
      }
      console.log($rootScope.cart);
    };
  });
  app.controller('cart',function($scope,$http,$rootScope){
    $scope.cart = $rootScope.cart || [];
    $scope.getCartPrice = function(){
      var total = 0;
      $scope.cart.forEach(function (product) {
        total += product.price * product.quantity;
        console.log(product.quantity);
      });
      return total;
    };
    $scope.removeFromCart = function (product) {
      var newCart = [];
      $rootScope.cart.forEach(function (item) {
        if (item.id != product.id) {
          newCart.push(item);
        }
      });
      $scope.cart = newCart;
      $rootScope.cart = newCart;
      console.log($rootScope.cart);
    };
  });
  </script>
</html>
